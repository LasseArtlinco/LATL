<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LATL Layout Admin</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Allerta+Stencil&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #042940;
            --secondary-color: #005C53;
            --accent-color: #9FC131;
            --bright-color: #DBF227;
            --background-color: #D6D58E;
            --text-color: #042940;
            --light-gray: #f1f3f4;
            --medium-gray: #dadce0;
            --dark-gray: #5f6368;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            padding: 20px;
        }
        
        h1, h2, h3 {
            font-family: 'Allerta Stencil', sans-serif;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .nav-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .nav-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
            background-color: var(--light-gray);
        }
        
        .nav-tab.active {
            background-color: white;
            border-color: var(--medium-gray);
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background-color: white;
            border: 1px solid var(--medium-gray);
            border-top: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        button {
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #0d62d1;
        }
        
        button.secondary {
            background-color: var(--secondary-color);
        }
        
        button.secondary:hover {
            background-color: #2d9249;
        }
        
        button.danger {
            background-color: #ea4335;
        }
        
        button.danger:hover {
            background-color: #d33426;
        }
        
        input, select, textarea {
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 16px;
        }
        
        .form-row > div {
            flex: 1;
        }
        
        .band {
            background-color: var(--light-gray);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            border-left: 4px solid var(--primary-color);
        }
        
        .band-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .band-controls {
            display: flex;
            gap: 10px;
        }
        
        .color-preview {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 1px solid var(--medium-gray);
            vertical-align: middle;
            margin-right: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        table, th, td {
            border: 1px solid var(--medium-gray);
        }
        
        th, td {
            padding: 10px;
            text-align: left;
        }
        
        th {
            background-color: var(--light-gray);
        }
        
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .loading.show {
            display: flex;
        }
        
        .spinner {
            border: 4px solid var(--light-gray);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #4caf50;
            color: white;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1001;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        .toast.error {
            background-color: #ea4335;
        }
        
        #colorPalette, #fontConfig {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .error-banner {
            background-color: #ffebee;
            color: #c62828;
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #c62828;
            display: none;
        }
        
        .retry-button {
            background-color: #c62828;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            margin-left: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="loading">
        <div class="spinner"></div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <div class="container">
        <div class="header">
            <h1>LATL Layout Admin</h1>
            <button id="saveButton">Gem ændringer</button>
        </div>
        
        <div class="error-banner" id="errorBanner">
            Der opstod en fejl ved indlæsning af data. 
            <button class="retry-button" id="retryButton">Prøv igen</button>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="globalStyles">Globale stilarter</div>
            <div class="nav-tab" data-tab="layoutPages">Layout sider</div>
            <div class="nav-tab" data-tab="bandManagement">Bånd-styring</div>
        </div>
        
        <div class="tab-content active" id="globalStyles">
            <h2>Globale stilarter</h2>
            <p>Her kan du konfigurere globale stilarter, der anvendes på hele webstedet.</p>
            
            <div class="form-row">
                <div>
                    <h3>Farvepalette</h3>
                    <div id="colorPalette">
                        <div class="form-group">
                            <label>Primær farve (#042940)</label>
                            <div class="form-row">
                                <input type="color" id="primaryColor" value="#042940">
                                <input type="text" id="primaryColorHex" value="#042940">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Sekundær farve (#005C53)</label>
                            <div class="form-row">
                                <input type="color" id="secondaryColor" value="#005C53">
                                <input type="text" id="secondaryColorHex" value="#005C53">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Accent farve (#9FC131)</label>
                            <div class="form-row">
                                <input type="color" id="accentColor" value="#9FC131">
                                <input type="text" id="accentColorHex" value="#9FC131">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Lys accent farve (#DBF227)</label>
                            <div class="form-row">
                                <input type="color" id="brightColor" value="#DBF227">
                                <input type="text" id="brightColorHex" value="#DBF227">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Baggrund (#D6D58E)</label>
                            <div class="form-row">
                                <input type="color" id="backgroundColor" value="#D6D58E">
                                <input type="text" id="backgroundColorHex" value="#D6D58E">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Tekstfarve (#042940)</label>
                            <div class="form-row">
                                <input type="color" id="textColor" value="#042940">
                                <input type="text" id="textColorHex" value="#042940">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3>Skrifttyper</h3>
                    <div id="fontConfig">
                        <div class="form-group">
                            <label>Overskrift skrifttype</label>
                            <select id="headingFontFamily">
                                <option value="'Allerta Stencil', sans-serif" selected>Allerta Stencil</option>
                                <option value="'Open Sans', sans-serif">Open Sans</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="'Helvetica Neue', sans-serif">Helvetica Neue</option>
                                <option value="'Roboto', sans-serif">Roboto</option>
                                <option value="'Montserrat', sans-serif">Montserrat</option>
                                <option value="'Raleway', sans-serif">Raleway</option>
                                <option value="'Playfair Display', serif">Playfair Display</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Overskrift tykkelse</label>
                            <select id="headingFontWeight">
                                <option value="400" selected>Normal (400)</option>
                                <option value="500">Medium (500)</option>
                                <option value="600">Semi-bold (600)</option>
                                <option value="700">Bold (700)</option>
                                <option value="800">Extra-bold (800)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Brødtekst skrifttype</label>
                            <select id="bodyFontFamily">
                                <option value="'Open Sans', sans-serif" selected>Open Sans</option>
                                <option value="'Allerta Stencil', sans-serif">Allerta Stencil</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="'Helvetica Neue', sans-serif">Helvetica Neue</option>
                                <option value="'Roboto', sans-serif">Roboto</option>
                                <option value="'Lato', sans-serif">Lato</option>
                                <option value="'Source Sans Pro', sans-serif">Source Sans Pro</option>
                                <option value="'PT Sans', sans-serif">PT Sans</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Brødtekst tykkelse</label>
                            <select id="bodyFontWeight">
                                <option value="300">Light (300)</option>
                                <option value="400" selected>Normal (400)</option>
                                <option value="500">Medium (500)</option>
                                <option value="600">Semi-bold (600)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Pris skrifttype</label>
                            <select id="priceFontFamily">
                                <option value="'Allerta Stencil', sans-serif" selected>Allerta Stencil</option>
                                <option value="'Open Sans', sans-serif">Open Sans</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="'Helvetica Neue', sans-serif">Helvetica Neue</option>
                                <option value="'Roboto', sans-serif">Roboto</option>
                                <option value="'Montserrat', sans-serif">Montserrat</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Pris tykkelse</label>
                            <select id="priceFontWeight">
                                <option value="400" selected>Normal (400)</option>
                                <option value="500">Medium (500)</option>
                                <option value="600">Semi-bold (600)</option>
                                <option value="700">Bold (700)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Knap skrifttype</label>
                            <select id="buttonFontFamily">
                                <option value="'Open Sans', sans-serif" selected>Open Sans</option>
                                <option value="'Allerta Stencil', sans-serif">Allerta Stencil</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="'Helvetica Neue', sans-serif">Helvetica Neue</option>
                                <option value="'Roboto', sans-serif">Roboto</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Knap tykkelse</label>
                            <select id="buttonFontWeight">
                                <option value="400">Normal (400)</option>
                                <option value="500">Medium (500)</option>
                                <option value="600" selected>Semi-bold (600)</option>
                                <option value="700">Bold (700)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <h3>Global styling</h3>
            <div class="form-group">
                <label>CSS kode (avanceret)</label>
                <textarea id="globalCss" rows="10" placeholder="Indtast din CSS-kode her...">/* Eksempel på global styling */
body {
  line-height: 1.6;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 15px;
}

.button {
  transition: all 0.3s ease;
}

.button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}</textarea>
            </div>
        </div>
        
        <div class="tab-content" id="layoutPages">
            <h2>Layout sider</h2>
            <p>Her kan du se og redigere layouts for forskellige sider.</p>
            
            <div class="form-row">
                <div>
                    <label>Vælg side</label>
                    <select id="pageSelect">
                        <option value="">-- Vælg side --</option>
                    </select>
                </div>
                <div>
                    <label>Eller opret ny side</label>
                    <div class="form-row">
                        <input type="text" id="newPageId" placeholder="Indtast side-id (f.eks. 'forside')">
                        <button id="createPageButton">Opret</button>
                    </div>
                </div>
            </div>
            
            <div id="pageDetails" style="display: none;">
                <h3>Side detaljer</h3>
                <div class="form-group">
                    <label>Side ID</label>
                    <input type="text" id="currentPageId" disabled>
                </div>
                
                <h3>Layout data</h3>
                <div class="form-group">
                    <label>Layout data (JSON)</label>
                    <textarea id="layoutData" rows="10" placeholder="Layout data i JSON format..."></textarea>
                </div>
                
                <div class="form-row">
                    <button id="updatePageButton">Opdater side</button>
                    <button id="deletePageButton" class="danger">Slet side</button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="bandManagement">
            <h2>Bånd-styring</h2>
            <p>Her kan du styre bånd for den valgte side.</p>
            
            <div class="form-group">
                <label>Vælg side</label>
                <select id="bandPageSelect">
                    <option value="">-- Vælg side --</option>
                </select>
            </div>
            
            <div id="bandList" style="display: none;">
                <h3>Bånd på denne side</h3>
                <div id="bands"></div>
                
                <button id="addBandButton" class="secondary">Tilføj nyt bånd</button>
            </div>
            
            <div id="newBandForm" style="display: none;">
                <h3>Tilføj nyt bånd</h3>
                <div class="form-group">
                    <label>Bånd type</label>
                    <select id="newBandType">
                        <option value="slideshow">Slideshow</option>
                        <option value="product">Produkt (konfigurerbart)</option>
                        <option value="product_card" disabled>Produkt kort</option>
                        <option value="product_full" disabled>Produkt fuld</option>
                        <option value="html" disabled>HTML</option>
                        <option value="related_products" disabled>Relaterede produkter</option>
                        <option value="link" disabled>Link</option>
                        <option value="cta" disabled>Call to Action</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Bånd højde</label>
                    <select id="newBandHeight">
                        <option value="1">1x</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                        <option value="4">4x</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Bånd indhold (JSON)</label>
                    <textarea id="newBandContent" rows="6" placeholder='{"key": "value"}'></textarea>
                </div>
                
                <div class="form-group">
                    <label>Rækkefølge</label>
                    <input type="number" id="newBandOrder" min="1" value="1">
                </div>
                
                <div class="form-row">
                    <button id="saveBandButton">Gem bånd</button>
                    <button id="cancelBandButton">Annuller</button>
                </div>
            </div>
            
            <div id="editBandForm" style="display: none;">
                <h3>Rediger bånd</h3>
                <input type="hidden" id="editBandId">
                
                <div class="form-group">
                    <label>Bånd type</label>
                    <select id="editBandType">
                        <option value="slideshow">Slideshow</option>
                        <option value="product">Produkt (konfigurerbart)</option>
                        <option value="product_card" disabled>Produkt kort</option>
                        <option value="product_full" disabled>Produkt fuld</option>
                        <option value="html" disabled>HTML</option>
                        <option value="related_products" disabled>Relaterede produkter</option>
                        <option value="link" disabled>Link</option>
                        <option value="cta" disabled>Call to Action</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Bånd højde</label>
                    <select id="editBandHeight">
                        <option value="1">1x</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                        <option value="4">4x</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Bånd indhold (JSON)</label>
                    <textarea id="editBandContent" rows="6" placeholder='{"key": "value"}'></textarea>
                </div>
                
                <div class="form-group">
                    <label>Rækkefølge</label>
                    <input type="number" id="editBandOrder" min="1">
                </div>
                
                <div class="form-row">
                    <button id="updateBandButton">Opdater bånd</button>
                    <button id="deleteBandButton" class="danger">Slet bånd</button>
                    <button id="cancelEditButton">Annuller</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/admin-common.js"></script>
    <script>
        // DOM elementer
        const tabButtons = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const saveButton = document.getElementById('saveButton');
        const errorBanner = document.getElementById('errorBanner');
        const retryButton = document.getElementById('retryButton');
        
        // Global state
        let currentPageId = null;
        let layouts = [];
        let globalStyles = {
            global_styles: {},
            font_config: {},
            color_palette: {}
        };
        
        // Event listeners for tabs
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.dataset.tab;
                
                // Skift aktiv fane
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                button.classList.add('active');
                document.getElementById(tabId).classList.add('active');
                
                // Opdater indhold baseret på valgt fane
                if (tabId === 'layoutPages' || tabId === 'bandManagement') {
                    loadLayouts();
                } else if (tabId === 'globalStyles') {
                    loadGlobalStyles();
                }
            });
        });
        
        // Farvepalette event listeners
        document.querySelectorAll('input[type="color"]').forEach(colorInput => {
            const hexInput = document.getElementById(colorInput.id + 'Hex');
            
            colorInput.addEventListener('input', () => {
                hexInput.value = colorInput.value;
            });
            
            hexInput.addEventListener('input', () => {
                if (/^#[0-9A-F]{6}$/i.test(hexInput.value)) {
                    colorInput.value = hexInput.value;
                }
            });
        });
        
        // Global styles
        saveButton.addEventListener('click', saveGlobalStyles);
        retryButton.addEventListener('click', () => {
            errorBanner.style.display = 'none';
            init();
        });
        
        // Layout pages
        document.getElementById('pageSelect').addEventListener('change', handlePageChange);
        document.getElementById('createPageButton').addEventListener('click', createNewPage);
        document.getElementById('updatePageButton').addEventListener('click', updatePage);
        document.getElementById('deletePageButton').addEventListener('click', deletePage);
        
        // Band management
        document.getElementById('bandPageSelect').addEventListener('change', loadBands);
        document.getElementById('addBandButton').addEventListener('click', showNewBandForm);
        document.getElementById('saveBandButton').addEventListener('click', saveNewBand);
        document.getElementById('cancelBandButton').addEventListener('click', () => {
            document.getElementById('newBandForm').style.display = 'none';
            document.getElementById('bandList').style.display = 'block';
        });
        document.getElementById('updateBandButton').addEventListener('click', updateBand);
        document.getElementById('deleteBandButton').addEventListener('click', deleteBand);
        document.getElementById('cancelEditButton').addEventListener('click', () => {
            document.getElementById('editBandForm').style.display = 'none';
            document.getElementById('bandList').style.display = 'block';
        });
        
        // Initialiser app
        document.addEventListener('DOMContentLoaded', init);
        
        /**
         * Initialiser app
         */
        async function init() {
            try {
                await loadGlobalStyles();
                await loadLayouts();
            } catch (error) {
                console.error('Error initializing app:', error);
                errorBanner.style.display = 'block';
            }
        }
        
        /**
         * Load globale stilarter
         */
        async function loadGlobalStyles() {
            try {
                const result = await safeFetch(`${API_URL}/layout/global/styles`);
                
                if (result.status === 'success' && result.data) {
                    globalStyles = result.data;
                    
                    // Opdater UI med indlæste data
                    const colorPalette = globalStyles.color_palette || {};
                    const fontConfig = globalStyles.font_config || {};
                    const styles = globalStyles.global_styles || {};
                    
                    // Opdater farver
                    if (colorPalette.primary) {
                        document.getElementById('primaryColor').value = colorPalette.primary;
                        document.getElementById('primaryColorHex').value = colorPalette.primary;
                    }
                    
                    if (colorPalette.secondary) {
                        document.getElementById('secondaryColor').value = colorPalette.secondary;
                        document.getElementById('secondaryColorHex').value = colorPalette.secondary;
                    }
                    
                    if (colorPalette.accent) {
                        document.getElementById('accentColor').value = colorPalette.accent;
                        document.getElementById('accentColorHex').value = colorPalette.accent;
                    }
                    
                    if (colorPalette.bright) {
                        document.getElementById('brightColor').value = colorPalette.bright;
                        document.getElementById('brightColorHex').value = colorPalette.bright;
                    }
                    
                    if (colorPalette.background) {
                        document.getElementById('backgroundColor').value = colorPalette.background;
                        document.getElementById('backgroundColorHex').value = colorPalette.background;
                    }
                    
                    if (colorPalette.text) {
                        document.getElementById('textColor').value = colorPalette.text;
                        document.getElementById('textColorHex').value = colorPalette.text;
                    }
                    
                    // Opdater skrifttyper
                    if (fontConfig.heading) {
                        if (fontConfig.heading['font-family']) {
                            document.getElementById('headingFontFamily').value = fontConfig.heading['font-family'];
                        }
                        
                        if (fontConfig.heading['font-weight']) {
                            document.getElementById('headingFontWeight').value = fontConfig.heading['font-weight'];
                        }
                    }
                    
                    if (fontConfig.body) {
                        if (fontConfig.body['font-family']) {
                            document.getElementById('bodyFontFamily').value = fontConfig.body['font-family'];
                        }
                        
                        if (fontConfig.body['font-weight']) {
                            document.getElementById('bodyFontWeight').value = fontConfig.body['font-weight'];
                        }
                    }
                    
                    if (fontConfig.price) {
                        if (fontConfig.price['font-family']) {
                            document.getElementById('priceFontFamily').value = fontConfig.price['font-family'];
                        }
                        
                        if (fontConfig.price['font-weight']) {
                            document.getElementById('priceFontWeight').value = fontConfig.price['font-weight'];
                        }
                    }
                    
                    if (fontConfig.button) {
                        if (fontConfig.button['font-family']) {
                            document.getElementById('buttonFontFamily').value = fontConfig.button['font-family'];
                        }
                        
                        if (fontConfig.button['font-weight']) {
                            document.getElementById('buttonFontWeight').value = fontConfig.button['font-weight'];
                        }
                    }
                    
                    // Opdater CSS
                    if (styles.css) {
                        document.getElementById('globalCss').value = styles.css;
                    }
                }
            } catch (error) {
                console.error('Error loading global styles:', error);
                showToast('Fejl ved indlæsning af globale stilarter', true);
                throw error;
            }
        }
        
        /**
         * Gem globale stilarter
         */
        async function saveGlobalStyles() {
            try {
                const colorPalette = {
                    primary: document.getElementById('primaryColor').value,
                    secondary: document.getElementById('secondaryColor').value,
                    accent: document.getElementById('accentColor').value,
                    bright: document.getElementById('brightColor').value,
                    background: document.getElementById('backgroundColor').value,
                    text: document.getElementById('textColor').value
                };
                
                const fontConfig = {
                    heading: {
                        'font-family': document.getElementById('headingFontFamily').value,
                        'font-weight': document.getElementById('headingFontWeight').value
                    },
                    body: {
                        'font-family': document.getElementById('bodyFontFamily').value,
                        'font-weight': document.getElementById('bodyFontWeight').value
                    },
                    price: {
                        'font-family': document.getElementById('priceFontFamily').value,
                        'font-weight': document.getElementById('priceFontWeight').value
                    },
                    button: {
                        'font-family': document.getElementById('buttonFontFamily').value,
                        'font-weight': document.getElementById('buttonFontWeight').value
                    }
                };
                
                const globalStyles = {
                    css: document.getElementById('globalCss').value
                };
                
                const data = {
                    global_styles: globalStyles,
                    font_config: fontConfig,
                    color_palette: colorPalette
                };
                
                const result = await safeFetch(`${API_URL}/layout/global/styles`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (result.status === 'success') {
                    showToast('Globale stilarter blev gemt');
                }
            } catch (error) {
                console.error('Error saving global styles:', error);
                showToast('Fejl ved gemning af globale stilarter', true);
            }
        }
        
        /**
         * Load layouts
         */
        async function loadLayouts() {
            try {
                const result = await safeFetch(`${API_URL}/layout`);
                
                if (result.status === 'success' && result.data) {
                    layouts = result.data;
                    
                    // Opdater side dropdown
                    const pageSelect = document.getElementById('pageSelect');
                    const bandPageSelect = document.getElementById('bandPageSelect');
                    
                    // Ryd eksisterende muligheder
                    pageSelect.innerHTML = '<option value="">-- Vælg side --</option>';
                    bandPageSelect.innerHTML = '<option value="">-- Vælg side --</option>';
                    
                    // Tilføj layouts til dropdown
                    layouts.forEach(layout => {
                        if (layout.page_id !== 'global') {
                            const option = document.createElement('option');
                            option.value = layout.page_id;
                            option.textContent = layout.page_id;
                            
                            const bandOption = option.cloneNode(true);
                            
                            pageSelect.appendChild(option);
                            bandPageSelect.appendChild(bandOption);
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading layouts:', error);
                showToast('Fejl ved indlæsning af layouts', true);
                throw error;
            }
        }
        
        /**
         * Håndter sideændring
         */
        async function handlePageChange() {
            const selectedPageId = document.getElementById('pageSelect').value;
            
            if (selectedPageId) {
                try {
                    const result = await safeFetch(`${API_URL}/layout/${selectedPageId}`);
                    
                    if (result.status === 'success' && result.data) {
                        const layout = result.data;
                        currentPageId = layout.page_id;
                        
                        document.getElementById('currentPageId').value = layout.page_id;
                        document.getElementById('layoutData').value = JSON.stringify(layout.layout_data || {}, null, 2);
                        
                        document.getElementById('pageDetails').style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error loading page details:', error);
                    showToast('Fejl ved indlæsning af sidedetaljer', true);
                }
            } else {
                document.getElementById('pageDetails').style.display = 'none';
            }
        }
        
        /**
         * Opret ny side
         */
        async function createNewPage() {
            const pageId = document.getElementById('newPageId').value.trim();
            
            if (!pageId) {
                showToast('Indtast et gyldigt side-id', true);
                return;
            }
            
            try {
                const data = {
                    page_id: pageId,
                    layout_data: {}
                };
                
                const result = await safeFetch(`${API_URL}/layout`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (result.status === 'success') {
                    showToast(`Siden "${pageId}" blev oprettet`);
                    document.getElementById('newPageId').value = '';
                    await loadLayouts();
                    
                    // Vælg den nye side
                    document.getElementById('pageSelect').value = pageId;
                    handlePageChange();
                }
            } catch (error) {
                console.error('Error creating page:', error);
                showToast('Fejl ved oprettelse af side', true);
            }
        }
        
        /**
         * Opdater side
         */
        async function updatePage() {
            if (!currentPageId) {
                showToast('Ingen side valgt', true);
                return;
            }
            
            try {
                let layoutData;
                try {
                    layoutData = JSON.parse(document.getElementById('layoutData').value);
                } catch (e) {
                    showToast('Ugyldig JSON i layout data', true);
                    return;
                }
                
                const data = {
                    layout_data: layoutData
                };
                
                const result = await safeFetch(`${API_URL}/layout/${currentPageId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (result.status === 'success') {
                    showToast(`Siden "${currentPageId}" blev opdateret`);
                }
            } catch (error) {
                console.error('Error updating page:', error);
                showToast('Fejl ved opdatering af side', true);
            }
        }
        
        /**
         * Slet side
         */
        async function deletePage() {
            if (!currentPageId) {
                showToast('Ingen side valgt', true);
                return;
            }
            
            if (!confirm(`Er du sikker på, at du vil slette siden "${currentPageId}"?`)) {
                return;
            }
            
            try {
                const result = await safeFetch(`${API_URL}/layout/${currentPageId}`, {
                    method: 'DELETE'
                });
                
                if (result.status === 'success') {
                    showToast(`Siden "${currentPageId}" blev slettet`);
                    document.getElementById('pageDetails').style.display = 'none';
                    currentPageId = null;
                    await loadLayouts();
                }
            } catch (error) {
                console.error('Error deleting page:', error);
                showToast('Fejl ved sletning af side', true);
            }
        }
        
        /**
         * Load bånd for en side
         */
        async function loadBands() {
            const selectedPageId = document.getElementById('bandPageSelect').value;
            
            if (selectedPageId) {
                try {
                    const result = await safeFetch(`${API_URL}/bands/${selectedPageId}`);
                    
                    if (result.status === 'success') {
                        const bands = result.data || [];
                        
                        if (bands.length === 0) {
                            document.getElementById('bands').innerHTML = `
                                <p>Ingen bånd fundet for denne side.</p>
                            `;
                        } else {
                            // Sorter bånd efter rækkefølge
                            bands.sort((a, b) => a.band_order - b.band_order);
                            
                            let bandsHtml = '';
                            
                            bands.forEach(band => {
                                let bandTitle = '';
                                let bandDescription = '';
                                
                                if (band.band_type === 'slideshow') {
                                    const slides = band.band_content?.slides || [];
                                    bandTitle = slides[0]?.title || 'Unavngivet slideshow';
                                    bandDescription = `${slides.length} slide${slides.length !== 1 ? 's' : ''}`;
                                } else if (band.band_type === 'product') {
                                    bandTitle = band.band_content?.title || 'Unavngivet produkt';
                                    bandDescription = band.band_content?.subtitle || '';
                                } else if (band.band_type === 'html') {
                                    bandTitle = band.band_content?.title || 'HTML-indhold';
                                    bandDescription = 'HTML-bånd';
                                } else if (band.band_type === 'link') {
                                    bandTitle = band.band_content?.title || 'Link-bånd';
                                    bandDescription = band.band_content?.description || 'Link';
                                } else {
                                    bandTitle = `${band.band_type} bånd`;
                                    bandDescription = 'Ingen beskrivelse';
                                }
                                
                                bandsHtml += `
                                    <div class="band">
                                        <div class="band-header">
                                            <h4>${bandTitle}</h4>
                                            <div class="band-controls">
                                                <button class="edit-band" data-band-id="${band.band_id || band.id}">Rediger</button>
                                                <button class="delete-band" data-band-id="${band.band_id || band.id}">Slet</button>
                                            </div>
                                        </div>
                                        <p>${bandDescription}</p>
                                        <p>Type: ${band.band_type} | Højde: ${band.band_height}x | Position: ${band.band_order}</p>
                                    </div>
                                `;
                            });
                            
                            document.getElementById('bands').innerHTML = bandsHtml;
                            
                            // Tilføj event listeners til knapper
                            document.querySelectorAll('.edit-band').forEach(button => {
                                button.addEventListener('click', () => {
                                    const bandId = button.dataset.bandId;
                                    editBand(selectedPageId, bandId);
                                });
                            });
                            
                            document.querySelectorAll('.delete-band').forEach(button => {
                                button.addEventListener('click', () => {
                                    const bandId = button.dataset.bandId;
                                    if (confirm('Er du sikker på, at du vil slette dette bånd?')) {
                                        deleteBand(selectedPageId, bandId);
                                    }
                                });
                            });
                        }
                        
                        document.getElementById('bandList').style.display = 'block';
                        document.getElementById('newBandForm').style.display = 'none';
                        document.getElementById('editBandForm').style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error loading bands:', error);
                    showToast('Fejl ved indlæsning af bånd', true);
                }
            } else {
                document.getElementById('bandList').style.display = 'none';
            }
        }
        
        /**
         * Vis formular til at tilføje nyt bånd
         */
        function showNewBandForm() {
            document.getElementById('bandList').style.display = 'none';
            document.getElementById('newBandForm').style.display = 'block';
            document.getElementById('editBandForm').style.display = 'none';
            
            // Nulstil formularen
            document.getElementById('newBandType').value = 'slideshow';
            document.getElementById('newBandHeight').value = '1';
            document.getElementById('newBandContent').value = '{}';
            document.getElementById('newBandOrder').value = '1';
        }
        
        /**
         * Vis formular til at redigere et bånd
         */
        async function editBand(pageId, bandId) {
            try {
                const result = await safeFetch(`${API_URL}/bands/${pageId}/${bandId}`);
                
                if (result.status === 'success' && result.data) {
                    const band = result.data;
                    
                    // Udfyld formularen med båndets data
                    document.getElementById('editBandId').value = band.band_id || band.id;
                    document.getElementById('editBandType').value = band.band_type;
                    document.getElementById('editBandHeight').value = band.band_height;
                    document.getElementById('editBandOrder').value = band.band_order;
                    document.getElementById('editBandContent').value = JSON.stringify(band.band_content || {}, null, 2);
                    
                    // Vis redigerings-formularen
                    document.getElementById('bandList').style.display = 'none';
                    document.getElementById('newBandForm').style.display = 'none';
                    document.getElementById('editBandForm').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading band for edit:', error);
                showToast('Fejl ved indlæsning af bånd', true);
            }
        }
        
        /**
         * Gem nyt bånd
         */
        async function saveNewBand() {
            const pageId = document.getElementById('bandPageSelect').value;
            
            if (!pageId) {
                showToast('Vælg venligst en side', true);
                return;
            }
            
            try {
                let bandContent;
                try {
                    bandContent = JSON.parse(document.getElementById('newBandContent').value);
                } catch (e) {
                    showToast('Ugyldig JSON i bånd indhold', true);
                    return;
                }
                
                const data = {
                    band_type: document.getElementById('newBandType').value,
                    band_height: document.getElementById('newBandHeight').value,
                    band_order: document.getElementById('newBandOrder').value,
                    band_content: bandContent
                };
                
                const result = await safeFetch(`${API_URL}/bands/${pageId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (result.status === 'success') {
                    showToast('Båndet blev oprettet');
                    document.getElementById('newBandForm').style.display = 'none';
                    await loadBands();
                }
            } catch (error) {
                console.error('Error creating band:', error);
                showToast('Fejl ved oprettelse af bånd', true);
            }
        }
        
        /**
         * Opdater bånd
         */
        async function updateBand() {
            const pageId = document.getElementById('bandPageSelect').value;
            const bandId = document.getElementById('editBandId').value;
            
            if (!pageId || !bandId) {
                showToast('Manglende side eller bånd-id', true);
                return;
            }
            
            try {
                let bandContent;
                try {
                    bandContent = JSON.parse(document.getElementById('editBandContent').value);
                } catch (e) {
                    showToast('Ugyldig JSON i bånd indhold', true);
                    return;
                }
                
                const data = {
                    band_type: document.getElementById('editBandType').value,
                    band_height: document.getElementById('editBandHeight').value,
                    band_order: document.getElementById('editBandOrder').value,
                    band_content: bandContent
                };
                
                const result = await safeFetch(`${API_URL}/bands/${pageId}/${bandId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (result.status === 'success') {
                    showToast('Båndet blev opdateret');
                    document.getElementById('editBandForm').style.display = 'none';
                    await loadBands();
                }
            } catch (error) {
                console.error('Error updating band:', error);
                showToast('Fejl ved opdatering af bånd', true);
            }
        }
        
        /**
         * Slet bånd
         */
        async function deleteBand(pageId, bandId) {
            if (!pageId || !bandId) {
                const currentPageId = document.getElementById('bandPageSelect').value;
                const currentBandId = document.getElementById('editBandId').value;
                
                if (!currentPageId || !currentBandId) {
                    showToast('Manglende side eller bånd-id', true);
                    return;
                }
                
                pageId = currentPageId;
                bandId = currentBandId;
            }
            
            try {
                const result = await safeFetch(`${API_URL}/bands/${pageId}/${bandId}`, {
                    method: 'DELETE'
                });
                
                if (result.status === 'success') {
                    showToast('Båndet blev slettet');
                    document.getElementById('editBandForm').style.display = 'none';
                    await loadBands();
                }
            } catch (error) {
                console.error('Error deleting band:', error);
                showToast('Fejl ved sletning af bånd', true);
            }
        }
    </script>
</body>
</html>
